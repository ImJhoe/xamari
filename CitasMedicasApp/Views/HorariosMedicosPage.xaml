<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="CitasMedicasApp.Views.HorariosMedicosPage"
             Title="Horarios Médicos">

    <ContentPage.Content>
        <ScrollView Padding="20" BackgroundColor="#f8f9fa">
            <StackLayout Spacing="20">

                <!-- Título -->
                <Frame BackgroundColor="#1abc9c" HasShadow="True" CornerRadius="10">
                    <StackLayout Orientation="Horizontal" Spacing="10">
                        <Label Text="🕒" FontSize="24"/>
                        <Label Text="PUNTO 7: HORARIOS DISPONIBLES" 
                               TextColor="White" 
                               FontSize="16" 
                               FontAttributes="Bold"
                               VerticalOptions="Center"/>
                    </StackLayout>
                </Frame>

                <!-- Filtros -->
                <Frame BackgroundColor="White" HasShadow="True" CornerRadius="10">
                    <StackLayout Spacing="15">
                        <Label Text="Filtrar Horarios" 
                               FontAttributes="Bold" 
                               TextColor="#2c3e50"/>

                        <!-- Seleccionar Médico -->
                        <StackLayout>
                            <Label Text="Médico:" FontAttributes="Bold" TextColor="#555"/>
                            <Picker x:Name="MedicoPicker" 
                                    Title="Seleccione un médico"
                                    SelectedIndexChanged="OnMedicoSeleccionado"/>
                        </StackLayout>

                        <!-- Seleccionar Fecha -->
                        <StackLayout>
                            <Label Text="Fecha:" FontAttributes="Bold" TextColor="#555"/>
                            <DatePicker x:Name="FechaPicker" 
                                       Date="{x:Static sys:DateTime.Now}"
                                       DateSelected="OnFechaSeleccionada"
                                       xmlns:sys="clr-namespace:System;assembly=mscorlib"/>
                        </StackLayout>

                        <!-- Seleccionar Sucursal -->
                        <StackLayout>
                            <Label Text="Sucursal:" FontAttributes="Bold" TextColor="#555"/>
                            <Picker x:Name="SucursalPicker" 
                                    Title="Seleccione una sucursal"
                                    SelectedIndexChanged="OnSucursalSeleccionada"/>
                        </StackLayout>

                        <Button x:Name="BuscarHorariosButton"
                                Text="🔍 BUSCAR HORARIOS DISPONIBLES"
                                BackgroundColor="#1abc9c"
                                TextColor="White"
                                CornerRadius="25"
                                Clicked="OnBuscarHorariosClicked"/>
                    </StackLayout>
                </Frame>

                <!-- Lista de Horarios -->
                <Frame x:Name="HorariosFrame" 
                       BackgroundColor="White" 
                       HasShadow="True" 
                       CornerRadius="10"
                       IsVisible="False">
                    <StackLayout Spacing="15">
                        <Label x:Name="HorariosTitulo" 
                               Text="HORARIOS DISPONIBLES" 
                               FontAttributes="Bold" 
                               FontSize="16"
                               TextColor="#1abc9c"/>

                        <CollectionView x:Name="HorariosCollectionView">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="10" RowSpacing="5">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <StackLayout Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Spacing="10">
                                            <Label Text="🕒" FontSize="16"/>
                                            <Label Text="{Binding HorarioTexto}" 
                                                   FontAttributes="Bold" 
                                                   FontSize="16"/>
                                        </StackLayout>

                                        <Label Grid.Row="1" Grid.Column="0" 
                                               Text="{Binding EstadoTexto}" 
                                               FontSize="12" 
                                               TextColor="#7f8c8d"/>

                                        <Button Grid.Row="0" Grid.RowSpan="2" Grid.Column="1"
                                                Text="📅 Agendar"
                                                BackgroundColor="#27ae60"
                                                TextColor="White"
                                                FontSize="12"
                                                CornerRadius="15"
                                                Command="{Binding Source={x:Reference HorariosCollectionView}, Path=Parent.Parent.Parent.Parent.BindingContext.AgendarHorarioCommand}"
                                                CommandParameter="{Binding .}"
                                                IsVisible="{Binding EstaDisponible}"/>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                        <Label x:Name="NoHorariosLabel" 
                               Text="No hay horarios disponibles para la fecha seleccionada" 
                               FontSize="14" 
                               TextColor="#e74c3c"
                               HorizontalOptions="Center"
                               IsVisible="False"/>
                    </StackLayout>
                </Frame>

                <!-- Loading indicator -->
                <ActivityIndicator x:Name="LoadingIndicator" 
                                 IsVisible="False" 
                                 IsRunning="False" 
                                 Color="#1abc9c"/>

            </StackLayout>
        </ScrollView>
    </ContentPage.Content>
</ContentPage>